# Experiment: RunPods A40 - 50K SpliceVarDB Dataset

**Date**: December 17, 2025  
**Platform**: RunPods (NVIDIA A40, 47.6 GB VRAM)  
**Status**: üîÑ In Progress

---

## Objective

Scale up the ValidatedDeltaPredictor training from 8K to 50K samples to improve prediction accuracy. Previous experiments on local M1 Mac achieved r=0.507 with 8K samples; targeting r=0.55+ with full dataset.

## Hardware Configuration

| Component | Specification |
|-----------|---------------|
| GPU | NVIDIA A40 |
| VRAM | 47.6 GB |
| Platform | RunPods |
| Cost | ~$0.69/hr |

## Dataset

| Category | Count |
|----------|-------|
| Total variants | 50,715 |
| Splice-altering | 13,673 |
| Normal | 11,358 |
| Low-frequency | 25,601 |
| Conflicting | 83 |

### Train/Test Split
- **Train**: 49,282 variants (chromosomes 1-20, X)
- **Test**: 1,433 variants (chromosomes 21, 22)
- **Balanced training**: 22,132 samples (11,066 SA + 11,066 Normal)

---

## Experiments

### 1. Quick Test (Sanity Check)

**Config**: 1,000 samples, 40 epochs, batch_size=32

| Metric | Result |
|--------|--------|
| Pearson correlation | r = 0.504 |
| ROC-AUC | 0.583 |
| PR-AUC | 0.616 |
| Status | ‚úÖ Complete |

**Notes**: Baseline established, GPU pipeline working correctly.

---

### 2. Full Dataset (50K samples)

**Config**: 
- max_train=50,000
- max_test=5,000  
- epochs=60
- batch_size=64
- hidden_dim=128
- n_layers=6

| Metric | Expected | Result |
|--------|----------|--------|
| Pearson correlation | r > 0.55 | üîÑ Running |
| ROC-AUC | > 0.65 | üîÑ Running |
| PR-AUC | > 0.70 | üîÑ Running |

**Start time**: 2025-12-17 03:51:10 UTC  
**Estimated duration**: 6-10 hours

---

### 3. HyenaDNA Experiment (Planned)

**Config**: HyenaDNA encoder with validated delta targets

| Parameter | Value |
|-----------|-------|
| Model | hyenadna-tiny-1k-seqlen |
| Freeze encoder | True (initial) |
| Epochs | 40 |

**Status**: ‚è≥ Pending (after full_dataset completes)

---

## Observations

### Data Preparation Insights

1. **SpliceVarDB Distribution**: 
   - ~27% Splice-altering (clear positive class)
   - ~22% Normal (clear negative class)  
   - ~51% Low-frequency/Conflicting (uncertain, excluded from training)

2. **Balanced Sampling**: Using equal SA/Normal samples helps prevent class imbalance issues.

3. **Validated Delta Target Strategy**:
   - SA variants: Use base model delta (trusted because SpliceVarDB confirms)
   - Normal variants: Force zero delta (override base model - we know there's no effect)
   - This creates high-quality training signal

### GPU Utilization

- A40 with 47.6 GB VRAM easily handles batch_size=64
- Could potentially increase to batch_size=128 for faster training

---

## Commands to Monitor

```bash
# Check experiment progress
tail -f /workspace/meta-spliceai/gpu_exp_full_50k.log

# Attach to tmux session
tmux attach -t gpu_exp

# Check GPU usage
nvidia-smi
```

---

## Results Summary

| Experiment | Correlation | ROC-AUC | PR-AUC | Status |
|------------|-------------|---------|--------|--------|
| Quick Test (1K) | 0.504 | 0.583 | 0.616 | ‚úÖ |
| Full Dataset (50K) | - | - | - | üîÑ |
| HyenaDNA | - | - | - | ‚è≥ |

---

## Model Checkpoints

Saved to: `/workspace/meta-spliceai/data/mane/GRCh38/openspliceai_eval/meta_layer_dev/`

| Experiment | Path |
|------------|------|
| Quick Test | `20251217_034541/checkpoints/gpu_quick_test_1000_samples.pt` |
| Full Dataset | TBD |

---

## Next Steps

1. ‚úÖ Complete full 50K training
2. ‚è≥ Analyze correlation by variant type
3. ‚è≥ Run HyenaDNA experiment
4. ‚è≥ Compare with longer context windows
5. ‚è≥ Consider multi-step framework

---

*This experiment log will be updated as results come in.*

